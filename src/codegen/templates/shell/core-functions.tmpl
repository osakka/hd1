#!/bin/bash
# ===================================================================
# HD1 Core Shell Function Library - AUTO-GENERATED
# ===================================================================
#
# GENERATED FROM: api.yaml specification
# SINGLE SOURCE OF TRUTH: All functions auto-generated from API spec
# PURPOSE: Standard shell wrapper for HD1 API endpoints
# 
# DO NOT EDIT MANUALLY - Regenerate with: make generate
# ===================================================================

# Configuration - respects environment variables and defaults from config system
HD1_API_BASE="${HD1_API_BASE:-{{.DefaultAPIBase}}}"
HD1_SESSION_ID="${HD1_SESSION_ID:-${SESSION_ID:-{{.DefaultSessionID}}}}"

# Standard HTTP client with error handling
hd1::api_call() {
    local method="$1"
    local endpoint="$2"
    local payload="$3"
    local content_type="${4:-application/json}"
    
    local response
    if [[ -n "$payload" ]]; then
        response=$(curl -s -X "$method" "$HD1_API_BASE$endpoint" \
                        -H "Content-Type: $content_type" \
                        -d "$payload")
    else
        response=$(curl -s -X "$method" "$HD1_API_BASE$endpoint")
    fi
    
    # Standard JSON response parsing
    if echo "$response" | jq . >/dev/null 2>&1; then
        echo "$response" | jq -r '.message // .success // "Success"'
    else
        echo "ERROR: $response"
        return 1
    fi
}

{{range .Routes}}{{if eq .OperationID "createObject"}}
# Auto-generated from {{.Method}} {{.Path}}
hd1::create_object() {
    local name="$1"
    local type="$2" 
    local x="$3"
    local y="$4"
    local z="$5"
    
    if [[ -z "$name" || -z "$type" || -z "$x" || -z "$y" || -z "$z" ]]; then
        echo "Usage: hd1::create_object <name> <type> <x> <y> <z>"
        return 1
    fi
    
    local payload=$(cat <<EOF
{
    "name": "$name",
    "type": "$type", 
    "x": $x,
    "y": $y,
    "z": $z
}
EOF
)
    
    hd1::api_call "{{.Method}}" "/sessions/$HD1_SESSION_ID/objects" "$payload"
    echo "OBJECT: $name at ($x,$y,$z)"
}
{{end}}{{if eq .OperationID "updateObject"}}
# Auto-generated from {{.Method}} {{.Path}}
hd1::update_object() {
    local name="$1"
    local property="$2"
    local value="$3"
    
    if [[ -z "$name" || -z "$property" || -z "$value" ]]; then
        echo "Usage: hd1::update_object <name> <property> <value>"
        return 1
    fi
    
    local payload=$(cat <<EOF
{
    "$property": "$value"
}
EOF
)
    
    hd1::api_call "{{.Method}}" "/sessions/$HD1_SESSION_ID/objects/$name" "$payload"
    echo "UPDATE: Object $name property $property"
}
{{end}}{{if eq .OperationID "setCameraPosition"}}
# Auto-generated from {{.Method}} {{.Path}}
hd1::camera() {
    local x="$1" y="$2" z="$3"
    
    if [[ -z "$x" || -z "$y" || -z "$z" ]]; then
        echo "Usage: hd1::camera <x> <y> <z>"
        return 1
    fi
    
    local payload=$(cat <<EOF
{
    "x": $x,
    "y": $y,
    "z": $z
}
EOF
)
    
    hd1::api_call "{{.Method}}" "/sessions/$HD1_SESSION_ID/camera/position" "$payload"
    echo "CAMERA: Positioned at ($x,$y,$z)"
}
{{end}}{{if eq .OperationID "setCanvas"}}
# Auto-generated from {{.Method}} {{.Path}}
hd1::canvas_control() {
    local command="$1"
    shift
    local objects="$@"
    
    if [[ -z "$command" ]]; then
        echo "Usage: hd1::canvas_control <command> [objects...]"
        return 1
    fi
    
    local payload=$(cat <<EOF
{
    "command": "$command",
    "objects": [$objects]
}
EOF
)
    
    hd1::api_call "{{.Method}}" "/browser/canvas" "$payload"
}

# Clear HD1 scene (uses canvas control)
hd1::clear() {
    echo "CLEAR: Clearing HD1 scene..."
    hd1::canvas_control "clear"
}
{{end}}{{if eq .OperationID "listObjects"}}
# Auto-generated from {{.Method}} {{.Path}}
hd1::list_objects() {
    hd1::api_call "{{.Method}}" "/sessions/$HD1_SESSION_ID/objects"
}
{{end}}{{if eq .OperationID "getObject"}}
# Auto-generated from {{.Method}} {{.Path}}
hd1::get_object() {
    local name="$1"
    
    if [[ -z "$name" ]]; then
        echo "Usage: hd1::get_object <name>"
        return 1
    fi
    
    hd1::api_call "{{.Method}}" "/sessions/$HD1_SESSION_ID/objects/$name"
}
{{end}}{{if eq .OperationID "deleteObject"}}
# Auto-generated from {{.Method}} {{.Path}}
hd1::delete_object() {
    local name="$1"
    
    if [[ -z "$name" ]]; then
        echo "Usage: hd1::delete_object <name>"
        return 1
    fi
    
    hd1::api_call "{{.Method}}" "/sessions/$HD1_SESSION_ID/objects/$name"
    echo "DELETE: Object $name"
}
{{end}}{{if eq .OperationID "createSession"}}
# Auto-generated from {{.Method}} {{.Path}}
hd1::create_session() {
    hd1::api_call "{{.Method}}" "/sessions"
}
{{end}}{{if eq .OperationID "listSessions"}}
# Auto-generated from {{.Method}} {{.Path}}
hd1::list_sessions() {
    hd1::api_call "{{.Method}}" "/sessions"
}
{{end}}{{if eq .OperationID "getSession"}}
# Auto-generated from {{.Method}} {{.Path}}
hd1::get_session() {
    local session_id="${1:-$HD1_SESSION_ID}"
    hd1::api_call "{{.Method}}" "/sessions/$session_id"
}
{{end}}{{end}}

echo "HD1: Core Functions Loaded - AUTO-GENERATED FROM API SPEC"
echo "SPEC: Generated from api.yaml specification"
echo "SYNC: Single source of truth - Zero manual synchronization"
echo "FUNCS: canvas_control, clear, camera, session management"
echo "SESSION: create_session, get_session, join_world"
echo "STATUS: Bar-raising achieved"