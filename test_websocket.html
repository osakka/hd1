<!DOCTYPE html>
<html>
<head>
    <title>HD1 WebSocket Test</title>
</head>
<body>
    <h1>HD1 WebSocket Client ID Test</h1>
    <div id="log"></div>
    <script>
        const log = document.getElementById('log');
        
        function addLog(message) {
            const div = document.createElement('div');
            div.textContent = new Date().toISOString() + ': ' + message;
            log.appendChild(div);
            console.log(message);
        }
        
        // Test WebSocket connection
        const ws = new WebSocket('ws://localhost:8080/ws');
        
        ws.onopen = function() {
            addLog('WebSocket connected');
        };
        
        ws.onmessage = function(event) {
            const data = JSON.parse(event.data);
            addLog('Received: ' + JSON.stringify(data));
            
            if (data.type === 'client_init' && data.client_id) {
                addLog('SUCCESS: Client ID assigned: ' + data.client_id);
                window.clientId = data.client_id;
                
                // Test avatar move
                fetch('/api/avatars/' + data.client_id + '/move', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        position: {x: 2, y: 2, z: 2},
                        rotation: {x: 0, y: 0, z: 0}
                    })
                }).then(response => response.json())
                .then(data => {
                    addLog('Avatar move response: ' + JSON.stringify(data));
                });
            }
        };
        
        ws.onclose = function(event) {
            addLog('WebSocket closed: ' + event.code + ' ' + event.reason);
        };
        
        ws.onerror = function(error) {
            addLog('WebSocket error: ' + error);
        };
    </script>
</body>
</html>