id: lightbulb
name: "Light Bulb"
description: "Classic incandescent light bulb with screw base and glass envelope"
category: electronic
scale_compatible: ["cm", "m"]
mass: 0.06  # kg at meter scale (typical 60W bulb)
material: glass

dimensions:
  width: 0.06     # meters (60mm diameter)
  height: 0.11    # meters (110mm total height)
  depth: 0.06     # meters

physics_properties:
  friction: 0.4      # smooth glass surface
  restitution: 0.05  # glass breaks easily, very low bounce
  density: 2500.0    # kg/mÂ³ (glass)

complexity: simple
components:
  - glass_envelope
  - screw_base
  - filament

lighting_properties:
  type: point_light
  color: "#FFE5B4"      # warm white (3000K)
  intensity: 1.0
  range: 5.0            # meters
  decay: 2              # quadratic decay

tags: ["electronic", "glass", "lighting", "bulb", "illumination"]

script: |
  #!/bin/bash
  # Light Bulb Prop - Electronic Lighting Element with Real Illumination
  
  source "${HD1_ROOT}/lib/hd1lib.sh" 2>/dev/null || {
      echo "ERROR: HD1 core library not found"
      exit 1
  }
  
  INSTANCE_NAME="${1:-lightbulb}"
  POSITION_X="${2:-0}"
  POSITION_Y="${3:-0}" 
  POSITION_Z="${4:-0}"
  SCALE_FACTOR="${5:-1.0}"
  SESSION_ID="${6:-${HD1_SESSION_ID:-}}"
  LIGHT_ENABLED="${7:-true}"
  
  if [[ -z "$SESSION_ID" ]]; then
      echo "ERROR: Session ID required"
      exit 1
  fi
  
  echo "PROP: Creating light bulb instance '$INSTANCE_NAME' with lighting"
  
  # Base dimensions (scaled)
  BULB_HEIGHT=$(echo "0.07 * $SCALE_FACTOR" | bc -l)
  BULB_DIAMETER=$(echo "0.06 * $SCALE_FACTOR" | bc -l)
  BASE_HEIGHT=$(echo "0.04 * $SCALE_FACTOR" | bc -l)
  BASE_DIAMETER=$(echo "0.027 * $SCALE_FACTOR" | bc -l)
  
  # Screw base (bottom)
  BASE_Y=$(echo "$POSITION_Y + $BASE_HEIGHT / 2" | bc -l)
  hd1::create_object "${INSTANCE_NAME}_base" "cylinder" $POSITION_X $BASE_Y $POSITION_Z
  hd1::update_object "${INSTANCE_NAME}_base" "geometry" "radius:$(echo "$BASE_DIAMETER / 2" | bc -l);height:$BASE_HEIGHT"
  hd1::update_object "${INSTANCE_NAME}_base" "material" "color:#8B7355;metalness:0.8;roughness:0.3"
  
  # Glass envelope (main bulb)
  BULB_Y=$(echo "$POSITION_Y + $BASE_HEIGHT + $BULB_HEIGHT / 2" | bc -l)
  hd1::create_object "${INSTANCE_NAME}_envelope" "sphere" $POSITION_X $BULB_Y $POSITION_Z
  hd1::update_object "${INSTANCE_NAME}_envelope" "geometry" "radius:$(echo "$BULB_DIAMETER / 2" | bc -l)"
  hd1::update_object "${INSTANCE_NAME}_envelope" "material" "color:#F8F8FF;transparent:true;opacity:0.8;metalness:0.0;roughness:0.1"
  
  # Filament (inside bulb) - glows when light is on
  FILAMENT_Y=$(echo "$POSITION_Y + $BASE_HEIGHT + $BULB_HEIGHT / 2" | bc -l)
  FILAMENT_SIZE=$(echo "0.02 * $SCALE_FACTOR" | bc -l)
  hd1::create_object "${INSTANCE_NAME}_filament" "sphere" $POSITION_X $FILAMENT_Y $POSITION_Z
  hd1::update_object "${INSTANCE_NAME}_filament" "geometry" "radius:$FILAMENT_SIZE"
  
  if [[ "$LIGHT_ENABLED" == "true" ]]; then
      # Glowing filament when light is on
      hd1::update_object "${INSTANCE_NAME}_filament" "material" "color:#FF6B35;emissive:#FF6B35;emissiveIntensity:0.8;metalness:0.2;roughness:0.0"
      
      # Point light source at filament position
      LIGHT_INTENSITY=$(echo "1.0 * $SCALE_FACTOR" | bc -l)
      LIGHT_DISTANCE=$(echo "5.0 * $SCALE_FACTOR" | bc -l)
      hd1::create_object "${INSTANCE_NAME}_light" "light" $POSITION_X $FILAMENT_Y $POSITION_Z
      hd1::update_object "${INSTANCE_NAME}_light" "light" "type:point;color:#FFE5B4;intensity:$LIGHT_INTENSITY;distance:$LIGHT_DISTANCE;decay:2"
      
      echo "LIGHTING: Point light created with warm white (3000K) illumination"
      OBJECTS_CREATED=4
  else
      # Dim filament when light is off
      hd1::update_object "${INSTANCE_NAME}_filament" "material" "color:#444444;emissive:#111111;emissiveIntensity:0.1;metalness:0.8;roughness:0.8"
      echo "LIGHTING: Light disabled - filament appears dark"
      OBJECTS_CREATED=3
  fi
  
  echo "COMPONENTS: $OBJECTS_CREATED components created (base, envelope, filament, light)"
  echo "PHYSICS: Glass material, friction=0.4, mass=0.06kg"
  echo "LIGHTING: Configurable warm white point light"
  echo "SCALE: Adapted to scale factor $SCALE_FACTOR"
  echo "CONTROLS: Set LIGHT_ENABLED=false to turn off"
  echo "Prop instantiated: $INSTANCE_NAME"
  echo "Objects created: $OBJECTS_CREATED"