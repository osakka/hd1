<?xml version="1.0" encoding="UTF-8"?>
<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg">
  <title>HD1 System Architecture v5.0.6</title>
  
  <!-- Background -->
  <rect width="800" height="600" fill="#f8f9fa" stroke="#dee2e6" stroke-width="2"/>
  
  <!-- Title -->
  <text x="400" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#212529">HD1 (Holodeck One) - System Architecture v5.0.6</text>
  <text x="400" y="50" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#6c757d">API-First Game Engine Platform with Bulletproof Avatar Control</text>
  
  <!-- Client Layer -->
  <rect x="50" y="80" width="700" height="80" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="5"/>
  <text x="60" y="100" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#1976d2">Client Layer</text>
  
  <!-- Clients -->
  <rect x="70" y="110" width="120" height="40" fill="#ffffff" stroke="#1976d2" stroke-width="1" rx="3"/>
  <text x="130" y="135" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#1976d2">Browser WebUI</text>
  
  <rect x="210" y="110" width="120" height="40" fill="#ffffff" stroke="#1976d2" stroke-width="1" rx="3"/>
  <text x="270" y="135" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#1976d2">HD1 CLI Client</text>
  
  <rect x="350" y="110" width="120" height="40" fill="#ffffff" stroke="#1976d2" stroke-width="1" rx="3"/>
  <text x="410" y="135" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#1976d2">Shell Functions</text>
  
  <rect x="490" y="110" width="120" height="40" fill="#ffffff" stroke="#1976d2" stroke-width="1" rx="3"/>
  <text x="550" y="135" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#1976d2">JavaScript API</text>
  
  <rect x="630" y="110" width="110" height="40" fill="#ffffff" stroke="#1976d2" stroke-width="1" rx="3"/>
  <text x="685" y="135" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#1976d2">PlayCanvas 3D</text>
  
  <!-- API Gateway Layer -->
  <rect x="50" y="180" width="700" height="100" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2" rx="5"/>
  <text x="60" y="200" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#7b1fa2">API Gateway Layer</text>
  
  <!-- HTTP and WebSocket -->
  <rect x="70" y="210" width="300" height="60" fill="#ffffff" stroke="#7b1fa2" stroke-width="1" rx="3"/>
  <text x="220" y="230" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#7b1fa2">HTTP REST API</text>
  <text x="220" y="250" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#7b1fa2">86 Endpoints</text>
  <text x="220" y="265" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#6c757d">Auto-generated from api.yaml</text>
  
  <rect x="390" y="210" width="300" height="60" fill="#ffffff" stroke="#7b1fa2" stroke-width="1" rx="3"/>
  <text x="540" y="230" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#7b1fa2">WebSocket Hub</text>
  <text x="540" y="250" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#7b1fa2">Real-time Sync</text>
  <text x="540" y="265" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#6c757d">&lt;10ms latency</text>
  
  <!-- Core Engine Layer -->
  <rect x="50" y="300" width="700" height="120" fill="#e8f5e8" stroke="#388e3c" stroke-width="2" rx="5"/>
  <text x="60" y="320" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#388e3c">HD1 Core Engine</text>
  
  <!-- Core Components -->
  <rect x="70" y="330" width="150" height="80" fill="#ffffff" stroke="#388e3c" stroke-width="1" rx="3"/>
  <text x="145" y="350" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#388e3c">Session Store</text>
  <text x="145" y="365" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#388e3c">Thread-safe</text>
  <text x="145" y="378" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#388e3c">Entity-Component</text>
  <text x="145" y="391" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#388e3c">System (ECS)</text>
  <text x="145" y="404" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#6c757d">sync.RWMutex</text>
  
  <rect x="240" y="330" width="150" height="80" fill="#ffffff" stroke="#388e3c" stroke-width="1" rx="3"/>
  <text x="315" y="350" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#388e3c">World Manager</text>
  <text x="315" y="365" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#388e3c">YAML Configuration</text>
  <text x="315" y="378" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#388e3c">Multi-user Worlds</text>
  <text x="315" y="391" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#388e3c">Real-time Collaboration</text>
  <text x="315" y="404" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#6c757d">100+ clients/world</text>
  
  <rect x="410" y="330" width="150" height="80" fill="#ffffff" stroke="#388e3c" stroke-width="1" rx="3"/>
  <text x="485" y="350" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#388e3c">Avatar System</text>
  <text x="485" y="365" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#388e3c">GLB Model Loading</text>
  <text x="485" y="378" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#388e3c">High-frequency Sync</text>
  <text x="485" y="391" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#388e3c">Position Updates</text>
  <text x="485" y="404" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#6c757d">Multiplayer Ready</text>
  
  <rect x="580" y="330" width="150" height="80" fill="#ffffff" stroke="#388e3c" stroke-width="1" rx="3"/>
  <text x="655" y="350" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#388e3c">Camera System</text>
  <text x="655" y="365" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#388e3c">Free/Orbital Modes</text>
  <text x="655" y="378" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#388e3c">Smooth Movement</text>
  <text x="655" y="391" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#388e3c">TAB Toggle</text>
  <text x="655" y="404" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#6c757d">Momentum Physics</text>
  
  <!-- Data Layer -->
  <rect x="50" y="440" width="700" height="80" fill="#fff3e0" stroke="#f57c00" stroke-width="2" rx="5"/>
  <text x="60" y="460" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#f57c00">Data &amp; Configuration Layer</text>
  
  <!-- Data Components -->
  <rect x="70" y="470" width="160" height="40" fill="#ffffff" stroke="#f57c00" stroke-width="1" rx="3"/>
  <text x="150" y="495" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#f57c00">World Definitions</text>
  
  <rect x="250" y="470" width="160" height="40" fill="#ffffff" stroke="#f57c00" stroke-width="1" rx="3"/>
  <text x="330" y="495" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#f57c00">Avatar Assets</text>
  
  <rect x="430" y="470" width="160" height="40" fill="#ffffff" stroke="#f57c00" stroke-width="1" rx="3"/>
  <text x="510" y="495" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#f57c00">Configuration</text>
  
  <rect x="610" y="470" width="130" height="40" fill="#ffffff" stroke="#f57c00" stroke-width="1" rx="3"/>
  <text x="675" y="495" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#f57c00">Memory Pools</text>
  
  <!-- Specification Source -->
  <rect x="300" y="540" width="200" height="40" fill="#fff8e1" stroke="#ffa000" stroke-width="2" rx="5"/>
  <text x="400" y="565" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#ffa000">Single Source of Truth: api.yaml</text>
  
  <!-- Connection lines -->
  <!-- Clients to API -->
  <line x1="130" y1="150" x2="220" y2="210" stroke="#666" stroke-width="1"/>
  <line x1="270" y1="150" x2="220" y2="210" stroke="#666" stroke-width="1"/>
  <line x1="410" y1="150" x2="220" y2="210" stroke="#666" stroke-width="1"/>
  <line x1="550" y1="150" x2="540" y2="210" stroke="#666" stroke-width="1"/>
  <line x1="685" y1="150" x2="540" y2="210" stroke="#666" stroke-width="1"/>
  
  <!-- API to Core -->
  <line x1="220" y1="270" x2="220" y2="330" stroke="#666" stroke-width="2"/>
  <line x1="540" y1="270" x2="540" y2="330" stroke="#666" stroke-width="2"/>
  
  <!-- Core to Data -->
  <line x1="220" y1="410" x2="220" y2="470" stroke="#666" stroke-width="1"/>
  <line x1="400" y1="410" x2="400" y2="470" stroke="#666" stroke-width="1"/>
  <line x1="580" y1="410" x2="580" y2="470" stroke="#666" stroke-width="1"/>
  
  <!-- API.yaml to Core -->
  <line x1="400" y1="540" x2="400" y2="420" stroke="#ffa000" stroke-width="3" stroke-dasharray="5,5"/>
  
  <!-- Legend -->
  <rect x="50" y="550" width="180" height="40" fill="#ffffff" stroke="#ccc" stroke-width="1" rx="3"/>
  <text x="60" y="570" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#333">Legend:</text>
  <line x1="110" y1="575" x2="130" y2="575" stroke="#666" stroke-width="1"/>
  <text x="135" y="579" font-family="Arial, sans-serif" font-size="10" fill="#666">Data Flow</text>
  <line x1="110" y1="583" x2="130" y2="583" stroke="#ffa000" stroke-width="3" stroke-dasharray="3,3"/>
  <text x="135" y="587" font-family="Arial, sans-serif" font-size="10" fill="#ffa000">Code Generation</text>
</svg>